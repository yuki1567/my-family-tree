このworktreeでissue #{{ISSUE_NUMBER}}の開発を開始します。

【Issue情報】

- タイトル: {{ISSUE_TITLE}}
- ブランチ: {{BRANCH_NAME}}
- 環境: Monorepo(frontend/backend/shared) + 独立Docker環境（ポート競合なし）

【CRITICAL: 必須セットアップ手順（Docker強制実行）】
以下を**必ず順番通り**に実行してください。ローカル実行は絶対禁止です。

1. **依存関係のインストール**:

   ```bash
   # ローカル開発ツールのためのnpm install（Docker環境構築前に必要）
   npm install
   ```

2. **Docker環境とテストDB起動確認**:

   ```bash
   # 既存コンテナの状況確認
   docker-compose ps

   # 段階的起動（dbコンテナ競合回避）
   # 1) dbコンテナが未起動の場合は全て起動
   # 2) dbコンテナが起動している場合はappsコンテナのみ起動
   if ! docker-compose ps db | grep -q "Up"; then
     echo "📦 dbコンテナが未起動のため、全サービスを起動します"
     docker-compose --profile development up -d
   else
     echo "📦 既存dbコンテナを使用し、appsコンテナのみ起動します"
     docker-compose --profile development up -d --no-deps apps
   fi

   # 最終起動状況確認
   docker-compose ps
   ```

3. **アクセス確認**:
   - Frontend: http://localhost:{{APP_PORT}}
   - API: http://localhost:{{API_PORT}}

【品質チェック（実装前後で必須実行）】

```bash
# backendチェック
npm run docker:quality:backend

# frontendチェック
npm run docker:quality:frontend

# テスト実行
npm run docker:test:unit
npm run docker:test:integration
```

【CRITICAL: 実装ワークフロー（必須）】

1. **要件分析**: issueの内容を分析し、TodoWriteで実装計画を作成
2. **実装前説明**: 技術選定と実装方針をissueコメントで事前説明
3. **ドキュメント参照**: docs/ 内の技術仕様に厳密に従う
4. **段階的実装**: 小さく実装→テスト→コミットのサイクル
5. **受け入れ基準検証**: 実装完了後の厳密な要件チェック
6. **PR作成**: 詳細な技術判断根拠を含むPR作成
7. **品質チェック**: 全品質チェックコマンドが成功することを確認

【CRITICAL: コミットとPR戦略（必須）】

**段階的コミット要件**：

- 作業単位（実装→テスト→ドキュメント等）で必ずコミット
- コミットメッセージ形式: `[prefix](#{{ISSUE_NUMBER}}): [実装内容の要約]`

**コミットプレフィックス一覧**：

- `fix`: 既存の機能の問題を修正する場合に使用します
- `add`: 新しいファイルを追加する場合に使用します
- `feat`: 新しい機能を追加する場合に使用します
- `delete`: ファイルを削除する場合や、機能を削除する場合に使用します
- `rename`: ファイル名を変更する場合に使用します
- `move`: ファイルを移動する場合に使用します
- `revert`: 以前のコミットに戻す場合に使用します
- `docs`: ドキュメントを修正する場合に使用します
- `style`: コーディングスタイルの修正をする場合に使用します
- `test`: テストコードを修正する場合や、テストコードを追加する場合に使用します

**コミットタイミング（必須）**：

1. 新しいファイル・コンポーネント作成時
2. テスト追加・修正時
3. ドキュメント更新時
4. バグ修正時
5. リファクタリング完了時

**コミット例**：

```bash
git commit -m "add(#123): ユーザー作成APIエンドポイント追加"
git commit -m "test(#123): ユーザー作成APIのテスト追加"
git commit -m "docs(#123): API仕様書更新"
```

【実装前説明（必須）】
実装を開始する前に、以下をissueコメントで説明：

```bash
gh issue comment {{ISSUE_NUMBER}} --body "## 実装計画

**技術選定**：
- [選択する技術・手法]
- [選択理由と他の選択肢との比較]
- [想定されるリスクと対策]

**実装手順**：
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

実装を開始します。"
```

【受け入れ基準検証とチェックリスト更新（必須プロセス）】

1. **受け入れ基準の詳細確認**：

   ```bash
   # issueの受け入れ基準を再読み込み
   gh issue view {{ISSUE_NUMBER}}
   ```

2. **各基準の検証実行**：
   **A. 機能要件の検証**：
   - 各受け入れ基準に対して具体的なテストを実行
   - 手動確認が必要な項目は実際に動作確認
   - スクリーンショットやログ出力で証跡を残す

   **B. 技術要件の検証**：
   - 品質チェックコマンドの実行結果確認
   - テストカバレッジの確認
   - パフォーマンス・セキュリティ観点での確認

3. **検証結果の判定と対応**：

   **✅ 全ての基準を満たしている場合**：

   ```bash
   # A. issue側のチェックリスト更新
   gh issue edit {{ISSUE_NUMBER}} --body "[チェック済みマークを追加した更新本文]"

   # B. PR側のチェックリスト更新
   gh pr edit --body "[PRのチェックリストを完了に変更]"

   # C. 検証完了コメント
   gh pr comment --body "✅ 受け入れ基準検証完了

   **検証詳細**：
   - [基準1]: ✅ 検証済み
     - 検証方法: [具体的な確認手順]
     - 結果: [OK/期待通りの動作確認]
     - 証跡: [スクリーンショット/ログ等]
   - [基準2]: ✅ 検証済み
     - 検証方法: [具体的な確認手順]
     - 結果: [OK/期待通りの動作確認]
     - 証跡: [スクリーンショット/ログ等]

   **品質確認**：
   - テスト結果: 全て通過
   - 品質チェック: 全て通過

   レビューをお願いします 🙏"
   ```

   **❌ 満たしていない基準がある場合**：

   ```bash
   # 不足項目の明確化コメント
   gh pr comment --body "⚠️ 受け入れ基準の一部が未達成です

   **未達成項目**：
   - [基準X]: ❌ 未達成
     - 問題: [具体的に何が不足しているか]
     - 原因: [なぜ満たせなかったか]
     - 対応策: [追加実装・修正の計画]

   **対応予定**：
   1. [修正内容1]
   2. [修正内容2]

   追加実装を行います。"

   # 不足分の実装・修正を実行
   # [実装作業]

   # 修正完了後、再度検証プロセスを実行
   ```

4. **継続的検証サイクル**：
   - 修正を行った場合は、再度ステップ2から検証を実行
   - 全ての基準が満たされるまで実装・検証・修正のサイクルを繰り返す
   - 最終的に全基準クリア後にチェックリストを完了に更新

5. **検証不可能な基準への対応**：

   ```bash
   # 検証が困難な基準がある場合のエスカレーション
   gh issue comment {{ISSUE_NUMBER}} --body "🤔 検証が困難な受け入れ基準があります

   **該当基準**: [基準の内容]
   **問題**: [なぜ検証が困難か]
   **提案**: [代替の検証方法や基準の明確化依頼]

   ご確認をお願いします。"
   ```

【開発完了時の必須タスク】

1. **PR作成（必須）**：

   ```bash
   gh pr create --title "{{ISSUE_TITLE}}" --body "$(cat <<'EOF'
   ## 概要
   issue #{{ISSUE_NUMBER}}の要件を満たすため、以下の実装を行いました：
   - [具体的に何を解決したか]
   - [ユーザーにとってどのような価値を提供するか]
   - [システム全体への影響や改善点]

   ## 実装内容
   ### 追加・変更したファイル
   - [ファイル名]: [変更内容と理由]
   - [ファイル名]: [変更内容と理由]

   ### 技術的判断と根拠
   - **選択した技術・手法**: [具体的な技術名]
   - **選択理由**: [なぜこの方法を選んだか、他の選択肢との比較]
   - **既存システムとの整合性**: [既存コードとの一貫性確保方法]
   - **将来への考慮**: [拡張性・保守性への配慮]

   ## テスト結果
   ### 単体テスト
   ```

   [テスト実行コマンドとその結果を貼り付け]

   ```

   ### 結合テスト
   ```

   [テスト実行コマンドとその結果を貼り付け]

   ```

   ### 品質チェック
   ```

   [品質チェックコマンドとその結果を貼り付け]

   ```

   ## 受け入れ基準チェックリスト
   - [ ] [受け入れ基準1]: [確認方法]
   - [ ] [受け入れ基準2]: [確認方法]

   Closes #{{ISSUE_NUMBER}}
   EOF
   )"
   ```

2. **ラベル付与（issueの内容に応じて適切なラベルを選択）**：

   ```bash
   # 例：新機能の場合
   gh pr edit --add-label "feature"

   # 例：既存機能の改善の場合
   gh pr edit --add-label "enhancement"

   # 例：バグ修正の場合
   gh pr edit --add-label "bug"
   ```

   **利用可能なラベル**：
   - `bug`: 不具合や期待通りに動かない問題
   - `chore`: 開発環境・ビルド・設定の改善
   - `docs`: ドキュメント関連
   - `enhancement`: 既存コードの改善・拡張・修正
   - `feature`: 完全に新しい機能・コンポーネントの作成
   - `refactor`: 動作は変えずに内部のコードを整理・改善
   - `test`: テストコードの追加や修正

このworktreeは完全に独立した環境です。メインブランチや他のissueに影響しません。
上記の手順を厳密に守って開発を進めてください。
