# ============================================================
# Docker Compose Override Example (開発環境用)
# ============================================================
# このファイルは開発環境でdocker-compose.ymlの設定を
# オーバーライドするためのテンプレートです。
#
# 使用方法:
#   cp docker-compose.override.yml.example docker-compose.override.yml
#
# 注意:
#   - docker-compose.override.ymlはgitで管理されません（.gitignoreに含まれています）
#   - 各開発者が自分のローカル環境に合わせてカスタマイズしてください
# ============================================================

services:
  apps:
    build:
      target: development
    image: ${AWS_VAULT:-family-tree-app}
    container_name: ${AWS_VAULT:-family-tree-app}
    ports:
      - "${WEB_PORT:-3000}:3000"
      - "${API_PORT:-4000}:4000"
    volumes:
      - ./apps:/usr/src/apps
    environment:
      - NODE_ENV=development
      - AWS_VAULT
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_SESSION_TOKEN
      - AWS_REGION

  db:
    build:
      context: .
      dockerfile: docker/db/Dockerfile
    image: db
    container_name: family-tree-shared-db
    ports:
      - "5432:5432"
    environment:
      - AWS_VAULT
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_SESSION_TOKEN
      - AWS_REGION

  test-db:
    build:
      context: .
      dockerfile: docker/db/Dockerfile
    image: db
    container_name: test-db
    ports:
      - "5433:5432"
    environment:
      AWS_VAULT: ${AWS_VAULT}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_SESSION_TOKEN: ${AWS_SESSION_TOKEN}
      AWS_REGION: ${AWS_REGION}
    deploy:
      resources:
        limits:
          memory: 256m
    profiles:
      - test

networks:
  default:
    name: my-family-tree-shared
    external: true
