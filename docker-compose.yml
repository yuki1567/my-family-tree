services:
  apps:
    build:
      context: .
      dockerfile: docker/apps/Dockerfile
    image: ${AWS_VAULT}
    container_name: ${AWS_VAULT}
    working_dir: /usr/src
    ports:
      - "${WEB_PORT:-3000}:3000"
      - "${API_PORT:-4000}:4000"
    volumes:
      - ./apps:/usr/src/apps
    environment:
      - AWS_VAULT
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_SESSION_TOKEN
      - AWS_REGION

  db:
    build:
      context: .
      dockerfile: docker/db/Dockerfile
    image: ${AWS_VAULT:-family-tree-app}-db
    container_name: family-tree-shared-db
    environment:
      - AWS_VAULT
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_SESSION_TOKEN
      - AWS_REGION
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data

volumes:
  postgres-data:

networks:
  default:
    name: my-family-tree-shared
    external: true
