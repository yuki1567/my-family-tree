# Issue 管理

## 概要

このプロジェクトでは、GitHubのissue機能を使用してタスク管理を行います。
各issueは小さな作業単位（2-4時間）に分割し、明確な受け入れ基準を設定します。

## Issue分類とラベル

### ラベル定義

| ラベル        | 説明                                   | 使用例                                       |
| ------------- | -------------------------------------- | -------------------------------------------- |
| `bug`         | 不具合や期待通りに動かない問題         | ログインできない、データが正しく保存されない |
| `chore`       | 開発環境・ビルド・設定の改善           | Docker設定の更新、依存関係の更新             |
| `docs`        | ドキュメント関連                       | README更新、API仕様書作成                    |
| `enhancement` | 既存コードの改善・拡張・修正           | パフォーマンス改善、UIの改善                 |
| `feature`     | 完全に新しい機能・コンポーネントの作成 | ユーザー認証機能、新しいページの追加         |
| `refactor`    | 動作は変えずに内部のコードを整理・改善 | コードの構造改善、重複コード削除             |
| `test`        | テストコードの追加や修正               | 単体テスト追加、E2Eテスト改善                |

### ラベル選択ガイド

**機能追加の場合**:

- 全く新しい機能 → `feature`
- 既存機能の拡張 → `enhancement`

**問題修正の場合**:

- 動作しない・間違った動作 → `bug`
- コードの品質改善 → `refactor`

**その他**:

- 設定・環境関連 → `chore`
- 説明書・仕様書 → `docs`
- テスト関連 → `test`

## Issue作成要件

### タイトル作成

- 1行（最大50文字）
- 簡潔でわかりやすい表現

### 本文構成

#### 必須項目

1. **背景**
   - なぜこの作業が必要か
   - 現在の問題や課題

2. **提案内容**
   - 具体的に何を実装・修正するか
   - 技術的なアプローチ（分かる範囲で）

3. **受け入れ基準**
   - 最低3項目以上
   - 検証可能な具体的な基準
   - チェックボックス形式で記載

#### 本文テンプレート

```markdown
## 背景

[なぜこの作業が必要か]

## 提案内容

[具体的に何を実装・修正するか]

## 受け入れ基準

- [ ] [検証可能な基準1]
- [ ] [検証可能な基準2]
- [ ] [検証可能な基準3]
```

### Issue分割ガイドライン

**分割すべき場合**:

- 作業時間が4時間を超える見込み
- 複数の異なる技術領域にまたがる
- 独立して検証できる複数の要件がある

**分割例**:

```
大きなissue: "ユーザー管理機能の実装"
↓
小さなissue:
- "ユーザー作成API実装"
- "ユーザー一覧画面作成"
- "ユーザー編集API実装"
```

## 優先度管理

### 優先度決定方法

1. **タイトルの `[数字]` で昇順ソート**
   - 小さい数字 = 高優先度
   - 例: `[1]` > `[2]` > `[10]`

2. **数字なしのissueは最低優先度**

3. **同じ優先度の場合はissue番号昇順**

### 自動選択フロー

1. 未アサインのOpen issueを一覧取得

```bash
gh issue list --state open --assignee "" --json number,title,labels --limit 100
```

2. 最優先issueを自動選択

- **状態**: Open（未クローズ）
- **アサイン**: 未アサイン（assignees が空）
- **優先度**: 上記ルールに従って最高優先度

3. Issue情報の取得と確認

- 選択または指定されたissue番号の詳細を GitHub CLI で取得

```bash
gh issue view [issue番号]
```

## Issue ライフサイクル

### 状態管理

1. **Open**: 作業待ち
2. **In Progress**: 誰かにアサインされ作業中
3. **Closed**: 完了（PRマージ後）

### アサイン管理

- 作業開始時に自動アサイン（process-issueコマンド）
- 作業完了後はアサインを維持（履歴として）

### アサインコマンド

```bash
# issueを自分（現在のGitHubユーザー）にアサイン
gh issue edit [issue番号] --add-assignee @me
```

### 関連PR

- issue番号をPRタイトルに含める
- PR説明で `Closes #issue番号` を記載
- PRマージ時にissueが自動クローズ

## 受け入れ基準検証

### 検証プロセス

1. **検証準備**
   - 対象issueとPRの受け入れ基準を確認
   - 各基準が検証可能な状態であることを確認

2. **各基準の検証実行**

   **A. 機能要件の検証**
   - 各受け入れ基準に対して具体的なテストを実行
   - 手動確認が必要な項目は実際に動作確認
   - スクリーンショットやログ出力で証跡を残す

   **B. 技術要件の検証**
   - 品質チェックコマンドの実行結果確認
   - テストカバレッジの確認
   - パフォーマンス・セキュリティ観点での確認

3. **検証結果の判定と対応**

   **✅ 全ての基準を満たしている場合**

   ```bash
   # A. issue側のチェックリスト更新
   gh issue edit {{ISSUE_NUMBER}} --body "[チェック済みマークを追加した更新本文]"

   # B. PR側のチェックリスト更新
   gh pr edit --body "[PRのチェックリストを完了に変更]"

   # C. 検証完了コメント
   gh pr comment --body "✅ 受け入れ基準検証完了

   **検証詳細**：
   - [基準1]: ✅ 検証済み
     - 検証方法: [具体的な確認手順]
     - 結果: [OK/期待通りの動作確認]
     - 証跡: [スクリーンショット/ログ等]
   - [基準2]: ✅ 検証済み
     - 検証方法: [具体的な確認手順]
     - 結果: [OK/期待通りの動作確認]
     - 証跡: [スクリーンショット/ログ等]

   **品質確認**：
   - テスト結果: 全て通過
   - 品質チェック: 全て通過

   レビューをお願いします 🙏"
   ```

   **❌ 基準を満たしていない場合**

   ```bash
   # 検証結果コメント
   gh pr comment --body "❌ 受け入れ基準検証で問題を発見

   **検証結果**：
   - [基準1]: ✅ 検証済み
   - [基準2]: ❌ 未達成
     - 問題: [具体的な問題内容]
     - 対応方針: [修正予定の内容]
   - [基準3]: ⏳ 検証待ち（基準2の修正後に実施）

   修正を実施します。"
   ```

4. **継続的検証サイクル**
   - 修正を行った場合は、再度ステップ2から検証を実行
   - 全ての基準が満たされるまで実装・検証・修正のサイクルを繰り返す
   - 最終的に全基準クリア後にチェックリストを完了に更新

5. **検証不可能な基準への対応**

   ```bash
   # 検証が困難な基準がある場合のエスカレーション
   gh issue comment {{ISSUE_NUMBER}} --body "🤔 検証が困難な受け入れ基準があります

   **該当基準**: [基準の内容]
   **問題**: [なぜ検証が困難か]
   **提案**: [代替の検証方法や基準の明確化依頼]

   ご確認をお願いします。"
   ```

## ベストプラクティス

### Issue作成時

- [ ] 既存issueとの重複確認
- [ ] 実装状況の事前確認
- [ ] 適切なラベル付与
- [ ] 検証可能な受け入れ基準設定

### 作業中

- [ ] 進捗をissueコメントで報告
- [ ] 仕様変更があれば受け入れ基準を更新
- [ ] ブロッカーがあれば早期に報告

### 完了時

- [ ] 受け入れ基準すべてを検証
- [ ] PR作成とissueクローズ
- [ ] 関連ドキュメントの更新

## 関連コマンド

- `create-issue`: issue作成支援
- `process-issue`: 最優先issue選択と開発環境準備
- `gh issue list`: issue一覧表示
- `gh issue view [番号]`: issue詳細表示
