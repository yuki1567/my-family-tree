{"version":3,"file":"linesBeforeBlock.cjs","names":["_iterateJsdoc","_interopRequireDefault","require","e","__esModule","default","startPunctuators","Set","_default","exports","iterateJsdoc","context","jsdocNode","report","sourceCode","utils","_tokenBefore$loc","_jsdocNode$loc","checkBlockStarts","excludedTags","ignoreSameLine","lines","options","hasATag","tokensBefore","getTokensBefore","includeComments","tokenBefore","at","type","has","value","loc","end","line","start","_jsdocNode$loc2","_tokenBefore$loc2","startLine","sameLine","fix","fixer","indent","_jsdocNode$loc3","_tokenBefore$loc3","_jsdocNode$value$matc","spaceDiff","column","match","slice","tokenPrior","startColumn","_tokenPrior","_tokenPrior$loc","pop","repeat","insertTextAfter","iterateAllJsdocs","meta","docs","description","url","fixable","schema","additionalProperties","properties","items","module"],"sources":["../../src/rules/linesBeforeBlock.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc.js';\n\n/**\n * Punctuators that begin a logical group should not require a line before it skipped. Specifically\n * `[` starts an array, `{` starts an object or block, `(` starts a grouping, and `=` starts a\n * declaration (like a variable or a type alias).\n */\nconst startPunctuators = new Set([\n  '(', '=', '[', '{',\n]);\n\nexport default iterateJsdoc(({\n  context,\n  jsdocNode,\n  report,\n  sourceCode,\n  utils,\n}) => {\n  const {\n    checkBlockStarts,\n    excludedTags = [\n      'type',\n    ],\n    ignoreSameLine = true,\n    lines = 1,\n  } = context.options[0] || {};\n\n  if (utils.hasATag(excludedTags)) {\n    return;\n  }\n\n  const tokensBefore = sourceCode.getTokensBefore(jsdocNode, {\n    includeComments: true,\n  });\n  const tokenBefore = tokensBefore.at(-1);\n  if (\n    !tokenBefore || (\n      tokenBefore.type === 'Punctuator' &&\n      !checkBlockStarts &&\n      startPunctuators.has(tokenBefore.value)\n    )\n  ) {\n    return;\n  }\n\n  if (tokenBefore.loc?.end?.line + lines >=\n  /** @type {number} */\n      (jsdocNode.loc?.start?.line)\n  ) {\n    const startLine = jsdocNode.loc?.start?.line;\n    const sameLine = tokenBefore.loc?.end?.line === startLine;\n\n    if (sameLine && ignoreSameLine) {\n      return;\n    }\n\n    /** @type {import('eslint').Rule.ReportFixer} */\n    const fix = (fixer) => {\n      let indent = '';\n      if (sameLine) {\n        const spaceDiff = /** @type {number} */ (jsdocNode.loc?.start?.column) -\n        /** @type {number} */ (tokenBefore.loc?.end?.column);\n        // @ts-expect-error Should be a comment\n        indent = /** @type {import('estree').Comment} */ (\n          jsdocNode\n        ).value.match(/^\\*\\n([\\t ]*) \\*/u)?.[1]?.slice(spaceDiff);\n        if (!indent) {\n          /** @type {import('eslint').AST.Token|import('estree').Comment|undefined} */\n          let tokenPrior = tokenBefore;\n          let startColumn;\n          while (tokenPrior && tokenPrior?.loc?.start?.line === startLine) {\n            startColumn = tokenPrior.loc?.start?.column;\n            tokenPrior = tokensBefore.pop();\n          }\n\n          indent = ' '.repeat(\n            /* c8 ignore next */\n            /** @type {number} */ (startColumn ? startColumn - 1 : 0),\n          );\n        }\n      }\n\n      return fixer.insertTextAfter(\n        /** @type {import('eslint').AST.Token} */\n        (tokenBefore),\n        '\\n'.repeat(lines) +\n        (sameLine ? '\\n' + indent : ''),\n      );\n    };\n\n    report(`Required ${lines} line(s) before JSDoc block`, fix);\n  }\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Enforces minimum number of newlines before JSDoc comment blocks',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc/blob/main/docs/rules/lines-before-block.md#repos-sticky-header',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          checkBlockStarts: {\n            type: 'boolean',\n          },\n          excludedTags: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          ignoreSameLine: {\n            type: 'boolean',\n          },\n          lines: {\n            type: 'integer',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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","ignoreList":[]}